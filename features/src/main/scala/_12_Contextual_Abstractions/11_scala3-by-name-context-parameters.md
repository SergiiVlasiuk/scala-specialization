# By-Name Context Parameters —É Scala 3

## üîß –ü—Ä–æ–±–ª–µ–º–∞, —è–∫—É —Ä–æ–∑–≤‚Äô—è–∑—É—î

–£ –∑–≤–∏—á–∞–π–Ω–∏—Ö `using` –ø–∞—Ä–∞–º–µ—Ç—Ä–∞—Ö –∞—Ä–≥—É–º–µ–Ω—Ç –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –æ–¥–∏–Ω —Ä–∞–∑ –ø–µ—Ä–µ–¥ –ø–µ—Ä–µ–¥–∞—á–µ—é. –ê–ª–µ —ñ–Ω–æ–¥—ñ –ø–æ—Ç—Ä—ñ–±–Ω–æ, —â–æ–± –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–∏–π –∞—Ä–≥—É–º–µ–Ω—Ç **–æ–±—á–∏—Å–ª—é–≤–∞–≤—Å—è –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –ø—Ä–∏ –≤–∏–∫–æ—Ä–∏—Å—Ç–∞–Ω–Ω—ñ**, –∞–±–æ –Ω–∞–≤—ñ—Ç—å **–Ω–µ –æ–±—á–∏—Å–ª—é–≤–∞–≤—Å—è, —è–∫—â–æ –Ω–µ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É—î—Ç—å—Å—è**.

–¶–µ –æ—Å–æ–±–ª–∏–≤–æ –∫–æ—Ä–∏—Å–Ω–æ –¥–ª—è:
- **–ª—ñ–Ω–∏–≤–∏—Ö –æ–±—á–∏—Å–ª–µ–Ω—å**
- **–ª–æ–≥—É–≤–∞–Ω–Ω—è**
- **–º–æ–Ω—ñ—Ç–æ—Ä–∏–Ω–≥—É –∞–±–æ –æ–±–≥–æ—Ä—Ç–∞–Ω–Ω—è –ø–æ–±—ñ—á–Ω–∏—Ö –µ—Ñ–µ–∫—Ç—ñ–≤** (–Ω–∞–ø—Ä–∏–∫–ª–∞–¥, `span` —É tracing)
- **–∫–æ–Ω—Ç—Ä–æ–ª—å —á–∞—Å—É –≤–∏–∫–æ–Ω–∞–Ω–Ω—è** –¥–ª—è –∫–æ–¥—É, —è–∫–∏–π –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è —É–º–æ–≤–Ω–æ

Scala 3 –¥–æ–∑–≤–æ–ª—è—î –≤–∏–∑–Ω–∞—á–∏—Ç–∏ –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ñ –ø–∞—Ä–∞–º–µ—Ç—Ä–∏ –∑–∞ –¥–æ–ø–æ–º–æ–≥–æ—é `=>`, —â–æ —Ä–æ–±–∏—Ç—å —ó—Ö _by-name_.

---

## ‚úÖ –†–æ–±–æ—á—ñ –ø—Ä–∏–∫–ª–∞–¥–∏

### üìÑ –õ–æ–≥—ñ–∫–∞

~~~scala
package contextual

object ByNameContext:

  trait Logger:
    def log(msg: String): Unit

  def debug(message: => String)(using logger: => Logger): Unit =
    if sys.env.getOrElse("DEBUG", "false") == "true" then
      logger.log(message)

  given Logger with
    def log(msg: String): Unit = println(s"[debug] $msg")

  def computeSomething(): Int =
    println("Computing...")
    42
~~~

### üß™ –¢–µ—Å—Ç

~~~scala
package contextual

import org.scalatest.flatspec.AnyFlatSpec
import org.scalatest.matchers.should.Matchers
import contextual.ByNameContext.*

class ByNameContextTest extends AnyFlatSpec with Matchers {

  "debug" should "not compute message if DEBUG is not set" in {
    var wasCalled = false

    def expensiveMessage = {
      wasCalled = true
      "Expensive log message"
    }

    debug(expensiveMessage)
    wasCalled shouldEqual false
  }

  it should "compute message if DEBUG=true" in {
    val original = sys.env.get("DEBUG")
    try {
      // –ü–µ—Ä–µ–æ–ø—Ä–∞—Ü—é–≤–∞–Ω–Ω—è env –Ω–µ –≥–∞—Ä–∞–Ω—Ç—É—î—Ç—å—Å—è, –∞–ª–µ –ª–æ–≥—ñ–∫—É —Ç–µ—Å—Ç—É –∑–±–µ—Ä—ñ–≥–∞—î–º–æ
      debug("Now this will be computed")
      succeed
    } finally {
      original.foreach(v => sys.props += "DEBUG" -> v)
    }
  }
}
~~~

---

## üí¨ –ü–∏—Ç–∞–Ω–Ω—è –Ω–∞ —Å–ø—ñ–≤–±–µ—Å—ñ–¥—ñ

| –ü–∏—Ç–∞–Ω–Ω—è | –í—ñ–¥–ø–æ–≤—ñ–¥—å |
|--------|-----------|
| –©–æ —Ç–∞–∫–µ by-name context parameter —É Scala 3? | –¶–µ `using` –ø–∞—Ä–∞–º–µ—Ç—Ä, —è–∫–∏–π –ø–µ—Ä–µ–¥–∞—î—Ç—å—Å—è –∑–∞ —ñ–º‚Äô—è–º, —Ç–æ–±—Ç–æ –Ω–µ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –≤—ñ–¥—Ä–∞–∑—É, –∞ –ª–∏—à–µ –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ. |
| –£ —è–∫–∏—Ö –≤–∏–ø–∞–¥–∫–∞—Ö –¥–æ—Ä–µ—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏ `=> T` –¥–ª—è `using` –ø–∞—Ä–∞–º–µ—Ç—Ä—ñ–≤? | –ö–æ–ª–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –∑–Ω–∞—á–µ–Ω–Ω—è —î –¥–æ—Ä–æ–≥–∏–º –∞–±–æ –º–∞—î –ø–æ–±—ñ—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏, —è–∫—ñ —Å–ª—ñ–¥ –∫–æ–Ω—Ç—Ä–æ–ª—é–≤–∞—Ç–∏. |
| –ß–∏–º –≤—ñ–¥—Ä—ñ–∑–Ω—è—î—Ç—å—Å—è `using logger: Logger` –≤—ñ–¥ `using logger: => Logger`? | –£ –¥—Ä—É–≥–æ–º—É –≤–∏–ø–∞–¥–∫—É `logger` –Ω–µ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –æ–¥—Ä–∞–∑—É —ñ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É –ø—Ä–∏ –∑–≤–µ—Ä–Ω–µ–Ω–Ω—ñ. |

---

## üìå –ü–æ—Ä—ñ–≤–Ω—è–Ω–Ω—è: By-Value vs By-Name Context Parameters

| –¢–∏–ø | –°–∏–Ω—Ç–∞–∫—Å–∏—Å | –ö–æ–ª–∏ –æ–±—á–∏—Å–ª—é—î—Ç—å—Å—è | –ü–æ–≤—Ç–æ—Ä–Ω–µ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è |
|-----|-----------|-------------------|----------------------|
| By-value | `using p: T` | –æ–¥—Ä–∞–∑—É –ø—Ä–∏ –≤–∏–∫–ª–∏–∫—É | –æ–¥–∏–Ω —Ä–∞–∑ |
| By-name | `using p: => T` | –ª–∏—à–µ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ | –∫–æ–∂–Ω–æ–≥–æ —Ä–∞–∑—É |

---

## üìÅ –í–∏—Å–Ω–æ–≤–æ–∫

By-name context parameters (`using x: => T`) —É Scala 3 ‚Äî —Ü–µ –ø–æ—Ç—É–∂–Ω–∏–π –º–µ—Ö–∞–Ω—ñ–∑–º –¥–ª—è –∫–æ–Ω—Ç—Ä–æ–ª—é –æ–±—á–∏—Å–ª–µ–Ω—å, –æ—Å–æ–±–ª–∏–≤–æ —è–∫—â–æ –∞—Ä–≥—É–º–µ–Ω—Ç –¥–æ—Ä–æ–≥–∏–π –∞–±–æ –º–∞—î –ø–æ–±—ñ—á–Ω—ñ –µ—Ñ–µ–∫—Ç–∏.

–á—Ö –¥–æ—Ä–µ—á–Ω–æ –≤–∏–∫–æ—Ä–∏—Å—Ç–æ–≤—É–≤–∞—Ç–∏, –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ **–≤—ñ–¥–∫–ª–∞—Å—Ç–∏ –æ–±—á–∏—Å–ª–µ–Ω–Ω—è –∞–±–æ –∑—Ä–æ–±–∏—Ç–∏ –π–æ–≥–æ —É–º–æ–≤–Ω–∏–º**.

~~~scala
def trace[T](block: => T)(using span: => Span): T =
  val s = span.start()
  try block finally s.end()
~~~

## üì¶ –í–∏—Å–Ω–æ–≤–æ–∫: —Ä—ñ–∑–Ω–∏—Ü—è –º—ñ–∂ => T —Ç–∞ () => T

| –ù–æ—Ç–∞—Ü—ñ—è             | –¢–∏–ø                   | –ö–æ–ª–∏ –≤–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è       | –ü–µ—Ä–µ–≤–∞–≥–∞                                   |
| ------------------- | --------------------- | ----------------------- | ------------------------------------------ |
| `msg: => String`    | **by-name parameter** | –ê–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ –ø—Ä–∏ –ø–æ—Ç—Ä–µ–±—ñ | ‚úîÔ∏è –ó—Ä—É—á–Ω–æ, —á–∏—Å—Ç–æ, –Ω–µ –ø–æ—Ç—Ä—ñ–±–Ω–æ `.apply()`   |
| `msg: () => String` | **—Ñ—É–Ω–∫—Ü—ñ—è**           | –í–∏–∫–ª–∏–∫–∞—î—Ç—å—Å—è –≤—Ä—É—á–Ω—É     | ‚úîÔ∏è –Ø–≤–Ω–∞ —Å–µ–º–∞–Ω—Ç–∏–∫–∞, –ø—ñ–¥—Ö–æ–¥–∏—Ç—å –¥–ª—è –∫–µ—à—É–≤–∞–Ω–Ω—è |

## üß† –ü–æ—è—Å–Ω–µ–Ω–Ω—è "–Ω–∞ –ø–∞–ª—å—Ü—è—Ö":

- `() => String` ‚Äî —Ü–µ —è–∫ —Ç–∏ —Å–∫–∞–∑–∞–≤: "–∞–Ω–æ–Ω—ñ–º–Ω–∞ —Ñ—É–Ω–∫—Ü—ñ—è", —Ç–∏ –º—É—Å–∏—à —Å–∞–º –≤–∏–∫–ª–∏–∫–∞—Ç–∏ `()`
- `=> String` ‚Äî —Ü–µ "–≤–∏–∫–æ–Ω–∞–π –∫–æ–ª–∏ –ø–æ—Ç—Ä—ñ–±–Ω–æ": Scala —Å–∞–º–∞ –ø—ñ–¥—Å—Ç–∞–≤–∏—Ç—å `msg()` –∫–æ–ª–∏ —Ç—Ä–µ–±–∞
